/**
 * Created by mcake on 2016/3/31.
 */
!function(a,b,c){"use strict";var h,i,j,k,l,m,d=function(){},e=Array.prototype,f=String.prototype,g=e.slice;a.console||(a.console={log:d,error:d}),Date.now||(Date.now=function(){return+new Date}),a.JSON||function(){a.JSON={parse:function(a){return Function("return "+a)()}}}(),e.forEach||(e.forEach=function(a){for(var b=0,c=this.length;c>b;b++)!a||a(this[b],b,this)!==!1}),e.filter||(e.filter=function(a){for(var b=[],c=0,d=this.length;d>c;c++)a&&a(this[c],c,this)===!0&&b.push(this[c]);return b}),e.find||(e.find=function(a){for(var b=0,c=this.length;c>b;b++)if(a&&a(this[b],b,this)===!0)return this[b];return null}),e.map||(e.map=function(a){for(var b=0,c=this.length,d=[];c>b;b++)a&&d.push(a(this[b],b,this));return d}),e.indexOf||(e.indexOf=function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1}),f.trim||(f.trim=function(){return this.replace(/(^\s+)|(\s+$)/g,"")}),h=function(a){var c,d,e,b=g.call(arguments,1);for(e=0;e<b.length;e++)for(d in c=b[e])c.hasOwnProperty(d)&&(a[d]=c[d]);return a},i=function(a,b,c){var d=function(){};return d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a,a.superClass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b),h(a.prototype,c),h(a,b),a},j=function(){this._eventPool={},this._guid=0},j.prototype={addEvent:function(a,b,c){var e,d=this;return a in this._eventPool||(this._eventPool[a]=[]),b._guid=this._guid++,e=function(){return b.apply(c||d,arguments)},e._guid=b._guid,this._eventPool[a].push(e),this},once:function(a,b,c){return this.addEvent(a,function d(){b.apply(c||this,arguments),this.removeEvent(a,d)},this),this},removeEvent:function(a,b){var e,f;if(b===c)return delete this._eventPool[a],this;if(e=this._eventPool[a],!e)return this;for(f=0;f<e.length;f++)e[f]._guid===b._guid&&e.splice(f,1);return this},dispatchEvent:function(a){var d,b=g.call(arguments,1),c=this._eventPool[a];if(!c)return this;for(d=0;d<c.length;d++)"function"==typeof c[d]&&c[d].apply(this,b);return this},dispatchEvents:function(){var b,a=g.call(arguments);for(b in this._eventPool)a.unshift(b),this._dispatchEvent.apply(this,a);return this},success:function(a){return this.addEvent("success",a)},complete:function(a){return this.addEvent("complete",a)},error:function(a){return this.addEvent("error",a)},progress:function(a){return this.addEvent("progress",a)},clear:function(){return this._eventPool={},this}},k=function(a,b){this.delay=a,this._currentCount=0,this._lastTime=0,this._repeatCount=b,this.timer=null,k.superClass.constructor.call(this)},i(k,j,{start:function(){var b=this;return this._lastTime=Date.now(),this.timer=a.setInterval(function(){b._timerHandle()},1e3/60),this},stop:function(){return this.timer&&(a.clearInterval(this.timer),this.dispatchEvent("complete"),this.reset()),this},setRepeatCount:function(a){return this._repeatCount=a,this},_timerHandle:function(){var a=Date.now();if(a-this._lastTime>=this.delay){if(this._repeatCount&&++this._currentCount==this._repeatCount)return this.stop(),void 0;this._lastTime=a,this.dispatchEvent("timer")}},reset:function(){return this._currentCount=0,this.timer=null,this}}),l=function(a,c,d,e){this.el="string"==typeof e?b.getElementById(e):e,this._startFrame=0,this._frameCount=0,this._playTimes=-1,this._isPlay=!1,this.RESUrl=a,this.RES=c,this.frame=this.getMovieClipData(d),this.frameRate=this.frame.frameRate,this._totalFrame=this.frame.frames.length,this.RESUrl instanceof Array?(this._totalFrame=this.RESUrl.length,this.setFrame=this.setFrameByPath,this.elImg=b.createElement("img"),this.el.appendChild(this.elImg)):this.setFrame=this.setFrameBySprite,l.superClass.constructor.call(this),this._timer=new k(this.frameRate,this._repeatCount),this._initEvents()},i(l,j,{getMovieClipData:function(a){return this.RES.mc[a]||[]},gotoAndPlay:function(a,b){return a=Math.max(0,a-1),this._startFrame=a,this._frameCount=a,this._playTimes=b,this._playTimes>0&&(this._repeatCount=this._playTimes*this._totalFrame,this._timer.setRepeatCount(this._repeatCount)),this.setFrame(this._frameCount),this.play(),this},play:function(){return this._isPlay?this:(this._timer.start(),this._isPlay=!0,this)},stop:function(){return this._timer.stop(),this._isPlay=!1,this},setFrameBySprite:function(a){var b=this.frame.frames[a]||{},d=this.RES.res[b.res];if(d!=c)return this._timer.delay=b.duration||this.frameRate,this.el.style.width=d.w+"px",this.el.style.height=d.h+"px",this.el.style.marginLeft=(b.x||0)+"px",this.el.style.marginTop=(b.y||0)+"px",this.el.style.background="url("+this.RESUrl+") no-repeat "+-d.x+"px "+-d.y+"px",this},setFrameByPath:function(a){var b=this.frame.frames[a]||{};return this._timer.delay=b.duration||this.frameRate,this.el.style.marginLeft=(b.x||0)+"px",this.el.style.marginTop=(b.y||0)+"px",this.elImg.src=this.RESUrl[a],this},clear:function(){return this.el.style.width="",this.el.style.height="",this.el.style.marginLeft="",this.el.style.marginTop="",this.el.style.background="",this.elImg&&(this.el.removeChild(this.elImg),delete this.elImg),this},_initEvents:function(){this._timer.addEvent("timer",function(){++this._frameCount>this._totalFrame-1&&(this._frameCount=this._startFrame),this.setFrame(this._frameCount)},this),this._timer.addEvent("complete",function(){this.dispatchEvent("complete")},this)}}),m=function(){var g,k,l,n,o,p,q,r,s,d={},e=function(a,b,c){var d=new Image;d.onload=function(){d.onload=new Function,b&&b(d)},d.onerror=function(){d.onerror=new Function,c&&c(d),console.error("fail load:"+a)},a=/^https?:\/\//.test(a)?a:m.basePath+m.baseUrl+a,d.src=a},f=function(a){var b=this;f.superClass.constructor.call(this),e(a,function(a){b.dispatchEvent("success",a)},function(a){b.dispatchEvent("error",a)})};return i(f,j),g=function(b,c,d){var e=function(){if(a.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHttp")}catch(b){return null}}();if(e)return b=/^https?:\/\//.test(b)?b:m.baseUrl+b,e.open("GET",b,!0),e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status)try{c&&c(JSON.parse(e.responseText))}catch(a){}else d&&d(e),console.error("fail load:"+b)},e.send(null),e},k=function(a){var b=this;k.superClass.constructor.call(this),g(a,function(a){b.dispatchEvent("success",a)},function(a){b.dispatchEvent("error",a)})},i(k,j),l=function(a,b){"object"==typeof a&&("image"==a.type?e(a.url,function(){d[a.name]=a,b&&b(a)}):"json"==a.type?g(a.url,function(c){var e=h({},a,{data:c});d[a.name]=e,b&&b(e)}):(d[a.name]=a,b&&b(a)))},n=function(){return d},o=function(a){var f,g,h,i,j,k,l,b=/\[(\d+\-\d+)\]/,e=b.exec(a);if(e){for(f=[],g=RegExp.$1.split("-"),h=a.replace(b,"").split("_"),i=Number(g[0]);i<Number(g[1])+1;i++)j=h[0]+i+"_"+h[1],k=/^https?:\/\//.test(d[j].url)?d[j].url:m.basePath+m.baseUrl+d[j].url,f.push(k);return f}return l=d[a],l===c?console.error(a+" does not exist!"):"json"==l.type?l.data:m.basePath+m.baseUrl+l.url},p=function(a,c){var d,f,g,h;if("string"!=typeof a)return null;if(!/^(#|\.)/.test(a))return null;if(d=a.charAt(0),c=c||b,"#"==d)return b.getElementById(a.substr(1,a.length));if(b.querySelectorAll)return c.querySelectorAll(a);try{return c.getElementsByClassName(a)}catch(e){for(f=[],g=c.getElementsByTagName("*"),h=0;h<g.length;h++)(" "+g.className+" ").indexOf(" "+a+" ")>-1&&f.push(g[h]);return f}},q=function(a,b){var e,d=b.groups.find(function(b){return b.name==a});return d===c?console.error('group "'+a+'" dose not exsit!'):e=d.keys.split(",").map(function(a){return a.trim()})},r=function(a,b){var c=[];return a.forEach(function(a){b.indexOf(a.name)>-1&&c.push(a)}),c},s=function(a,b){var e,f,g,h,i,d=q(a,b);d!==c&&(e=r(b.resources,d),f=this,g=0,h=e.length,i=e[g],s.superClass.constructor.call(this),l(i,function j(){return f.dispatchEvent("progress",++g,h,i),g>h-1?(f.dispatchEvent("complete"),void 0):(l(i=e[g],j),void 0)}))},i(s,j),{IMGloader:f,JSONloader:k,loadGroup:s,getAsset:n,getRes:o,el:p}}(),m.basePath="",m.baseUrl="images/",a.Timer=k,a.MovieClip=l,a.Resource=m}(window,window.document);