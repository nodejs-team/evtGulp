/**
 * Created by mcake on 2016/4/14.
 */
!function(a){var c,d,e,f,g,h,i,j,k,l,m;a.extend(a.easing,{easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c}}),c={"slide-down-l":function(b,c,d){var e=a(b);e.css({opacity:0,marginLeft:.3*-b.offsetWidth,marginTop:.8*-b.offsetHeight}),setTimeout(function(){e.animate({opacity:1,marginLeft:0,marginTop:0},1e3,"easeOutCubic",function(){d&&d()})},c)},"slide-down-r":function(b,c,d){var e=a(b);e.css({opacity:0,marginLeft:.15*b.offsetWidth,marginTop:.8*-b.offsetHeight}),setTimeout(function(){e.animate({opacity:1,marginLeft:0,marginTop:0},1e3,"easeOutCubic",function(){d&&d()})},c)},"slide-up-l":function(b,c,d){var e=a(b);e.css({opacity:0,marginLeft:.5*-b.offsetWidth,marginTop:.5*b.offsetHeight}),setTimeout(function(){e.animate({opacity:1,marginLeft:0,marginTop:0},1e3,"easeOutCubic",function(){d&&d()})},c)},"slide-up-r":function(b,c,d){var e=a(b);e.css({opacity:0,marginLeft:.5*b.offsetWidth,marginTop:.5*b.offsetHeight}),setTimeout(function(){e.animate({opacity:1,marginLeft:0,marginTop:0},1e3,"easeOutCubic",function(){d&&d()})},c)},"slide-up":function(b,c,d){var e=a(b);e.css({opacity:0,marginTop:.5*b.offsetHeight}),setTimeout(function(){e.animate({opacity:1,marginTop:0},1e3,"easeOutCubic",d)},c)},"fade-in":function(b,c,d){var e=a(b);e.css({opacity:0}),setTimeout(function(){e.animate({opacity:1},800,d)},c)}},d=function(){var a=/MSIE (\d+\.\d+)/.exec(navigator.userAgent);return!a||a[1]>9?!0:!1}(),e=function(a){var e,b=a.getAttribute("data-anim");c[b]&&(e=1e3*Number(a.getAttribute("data-delay")||0),d?(a.className=[a.className,b].join(" "),a.style["-webkit-animation-delay"]=e+"ms",a.style["animationDelay"]=e+"ms"):c[b].call(a,a,e))},f=function(b){a(b).find("[data-anim]").each(function(){e(this)})},Resource.baseUrl="resource/",g={loading:function(){var a=new MovieClip(Resource.getRes("loading_png"),Resource.getRes("loading_json"),"loading","loading_anim");return a.gotoAndPlay(1,-1),a},book:function(){var a=new MovieClip(Resource.getRes("book_png"),Resource.getRes("book_json"),"book","book");return a},mouseC:function(){var a=new MovieClip(Resource.getRes("mouse_c_png"),Resource.getRes("mouse_c_json"),"mouse_c","mouse_c");return a.gotoAndPlay(1,-1),a},birdC:function(){var a=new MovieClip(Resource.getRes("bird_c_png"),Resource.getRes("bird_c_json"),"bird_c","bird_c");return a.gotoAndPlay(1,-1),a},skating:function(){var a,b,c=new MovieClip(b=Resource.getRes("skating_png"),a=Resource.getRes("skating_json"),"skating","skating");c.gotoAndPlay(1,1),c.once("complete",function(){a["mc"]["skating"]["frames"]=a["mc"]["skating"]["frames"].slice(20),c=new MovieClip(b,a,"skating","skating"),c.gotoAndPlay(1,-1)})},fish:function(){var a=new MovieClip(Resource.getRes("fish_png"),Resource.getRes("fish_json"),"fish","fish");return a.gotoAndPlay(1,-1),a},house:function(){var a=new MovieClip(Resource.getRes("house_png"),Resource.getRes("house_json"),"house","house");return a.gotoAndPlay(1,-1),a},mouse:function(){var a,b,c=new MovieClip(b=Resource.getRes("mouse_png"),a=Resource.getRes("mouse_json"),"mouse","mouse");c.gotoAndPlay(1,1),c.once("complete",function(){a["mc"]["mouse"]["frames"]=a["mc"]["mouse"]["frames"].slice(28),c=new MovieClip(b,a,"mouse","mouse"),c.gotoAndPlay(1,-1)})},bird:function(){var a,b,c=new MovieClip(b=Resource.getRes("bird_png"),a=Resource.getRes("bird_json"),"bird","bird");c.gotoAndPlay(1,1),c.once("complete",function(){a["mc"]["bird"]["frames"]=a["mc"]["bird"]["frames"].slice(35),c=new MovieClip(b,a,"bird","bird"),c.gotoAndPlay(1,-1)})},man:function(){var a,b,c=new MovieClip(b=Resource.getRes("man_png"),a=Resource.getRes("man_json"),"man","man");c.gotoAndPlay(1,1),c.once("complete",function(){a["mc"]["man"]["frames"]=a["mc"]["man"]["frames"].slice(25),c=new MovieClip(b,a,"man","man"),c.gotoAndPlay(1,-1)})}},h=function(){var c,d,e,b=function(){this.superClass.constructor.call(this),this.sceneContainer=a("#first_scene"),this.stageH=this.sceneContainer.closest(".evt-section").height(),this.book=this.sceneContainer.find(".book"),this.book._w=this.book.width(),this.book._y=parseFloat(this.book.css("top"))||0,this.title=this.sceneContainer.find(".title"),this.title._y=parseFloat(this.title.css("top"))||0,this.titleText=this.sceneContainer.find(".title-text"),this.titleText._y=parseFloat(this.titleText.css("top"))||0,this.arrow=this.sceneContainer.find(".arrow"),this.arrow._y=parseFloat(this.arrow.css("top"))||0,this.arrowSprite=this.sceneContainer.find(".arrow-wrap"),this.arrowSprite._y=parseFloat(this.arrowSprite.css("top"))||0,this.bookMC=g.book(),this.bookMC.setFrame(0),this.setAnimation()};return ClassExtend(b,CustEvent,{setAnimation:function(){var b,a=this;this.title.delay(300).animate({opacity:1,marginTop:0},800,"easeOutCubic"),this.titleText.delay(800).animate({opacity:1,marginTop:0},800,"easeOutCubic"),b=function(){a.arrow.animate({marginTop:30},600,"easeInCubic").animate({marginTop:0},600,"easeOutCubic",function(){setTimeout(b,200)})},b.call(this)},setBookFrame:function(a){var b=this.bookMC.totalFrames;a>b||this.bookMC.gotoAndStop(a)},setScroll:function(a){this.setViewPort(-this.stageH/2+(a-2*this.stageH))},setViewPort:function(a){this.sceneContainer.get(0).style.top=a+"px"},setScrollAnim:function(a){var b=a/(this.stageH/2),c=Math.max(0,1-b),d=1+.32*b,e=.8*a;this.book.get(0).style.zoom=d,this.book.css({top:this.book["_y"]+e/3,marginLeft:-this.book["_w"]*(d-1)/1.5}),this.title.css({opacity:c,top:this.title["_y"]+e}),this.titleText.css({opacity:c,top:this.titleText["_y"]+e}),this.arrowSprite.css({opacity:c,top:this.arrowSprite["_y"]+e})}}),c=function(){this.superClass.constructor.call(this),this.sceneContainer=a("#second_scene"),this.stageH=this.sceneContainer.closest(".evt-section").height(),this.initEvents()},ClassExtend(c,CustEvent,{setAnimation:function(){g.house(),g.mouse(),g.bird(),g.man()},setScroll:function(a){this.setViewPort(-this.stageH/2+(a-this.stageH))},setViewPort:function(a){this.sceneContainer.get(0).style.top=a+"px"},initEvents:function(){this.once("SCENE_ENTER_2",function(){this.setAnimation()},this)}}),d=function(){this.superClass.constructor.call(this),this.sceneContainer=a("#third_scene"),this.stageH=this.sceneContainer.closest(".evt-section").height(),this.initEvents()},ClassExtend(d,CustEvent,{setAnimation:function(){g.mouseC(),g.birdC(),g.skating(),g.fish()},setScroll:function(a){this.setViewPort(-this.stageH/1.6+(a-2*this.stageH))},setViewPort:function(a){this.sceneContainer.get(0).style.top=a+"px"},initEvents:function(){this.once("SCENE_ENTER_3",function(){this.setAnimation()},this)}}),e=function(){this.superClass.constructor.call(this),this.sceneContainer=a("#fourth_scene"),this.stageH=this.sceneContainer.closest(".evt-section").height(),this.initEvents()},ClassExtend(e,CustEvent,{setAnimation:function(){f(this.sceneContainer)},setScroll:function(a){this.setViewPort(Math.min(0,-this.stageH+(a-2*this.stageH)))},setViewPort:function(a){this.sceneContainer.get(0).style.top=a+"px"},initEvents:function(){this.once("SCENE_ENTER_4",function(){this.setAnimation()},this)}}),{Scene1:b,Scene2:c,Scene3:d,Scene4:e}}(),i=function(a){var b;return this.type=a,this.snowEl=document.createElement("div"),a="snow"+this.type,(b=Resource.getRes("snow_json",a))?(this.snowUrl=Resource.getRes("snow_png"),this.width=b.w,this.height=b.h,this.hasOpacity="opacity"in document.body.style,this.addStyle(b),void 0):this},ClassExtend(i,{addStyle:function(a){for(var b in a)this.snowEl.style.position="absolute",this.snowEl.style.width=a.w+"px",this.snowEl.style.height=a.h+"px",this.snowEl.style.background="url("+this.snowUrl+") "+-a.x+"px "+-a.y+"px no-repeat"},setStyle:function(a){for(var b in a)"opacity"!=b||this.hasOpacity?this.snowEl.style[b]=a[b]:(this.snowEl.style.zoom="1",this.snowEl.style.filter="alpha(opacity="+100*a[b]+")")}}),j=function(b,c,d,e){this.snowX=c,this.snowY=d,this.container=a(b).get(0),this.scrollHolder=e,this.snowStack=new Array,this.stageH=800,this.stageW=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,this.createSnows()},ClassExtend(j,CustEvent,{createSnows:function(){for(var a=1;13>a;a++)this.createSnow(a)},createSnow:function(a){var b=new i(a);b.setStyle({opacity:0,"-webkit-transform":"scale(0.4)",transform:"scale(0.4)",left:this.snowX-b.width/2+"px",top:this.snowY-b.height/2+"px"}),b.typeIndex=a,b.randOffsetX=this.rand(0,500),this.container.appendChild(b.snowEl),this.snowStack.push(b)},doAnimate:function(a,b){var c=b/this.stageH/4,d=a.typeIndex<7?!0:!1,e=a.typeIndex*this.stageW/15,f=Math.min(b/this.scrollHolder,1),g=60*(b/this.stageH),h=.05;b>2*this.stageH&&(h=.22),b>2.5*this.stageH&&(h=.32),a.setStyle({opacity:f,"-webkit-transform":"scale("+f+") rotate("+g+"deg)",transform:"scale("+f+") rotate("+g+"deg)",top:this.snowY-b*h+a.randOffsetX+"px",left:this.snowX+(d?-1:1)*Math.sin(5*c)*e+"px"})},setAnimates:function(a){for(var b=0;b<this.snowStack.length;b++)this.doAnimate(this.snowStack[b],a)},rand:function(a,b){return a+Math.random()*(b-a)}}),k=function(){this.loadResource()},ClassExtend(k,{createScenes:function(){var b,c,d;for(b=0;4>b;b++)this["scene"+(b+1)]=new h["Scene"+(b+1)];this.container=a("#wb_container"),this.sections=this.container.find(".evt-section"),this.numChildren=this.sections.length,this.book=a("#book"),this.scrollNode=document.getElementById("evt_scroll_view"),this.sceneContainer=this.container.find(".evt-views"),this.bigMan=a("#bigMan"),this.snowContainer=a("#snow_scene"),this.bigManH=this.bigMan.height(),this.stageH=parseFloat(this.sceneContainer.find(".evt-section").eq(0).css("height"))||0,this.setScrollView(),this.initEvents(),c=this.book.offset(),d=this.book.height()/2,this.snowScene=new j(this.snowContainer,c.left,c.top+d/2,d/2)},loadResource:function(){var a=this,b=function(){a.loadingMC.stop(),Resource.el("#evt_loading").style.display="none",Resource.el("#wb_container").style.display="block",l(Resource.el("#wb_container")),a.createScenes()};new Resource.JSONloader("default.res.json").success(function(c){var d=new Resource.loadGroup("loading",c);d.addEvent("complete",function(){var d,e;a.loadingMC=g.loading(),d=new Resource.loadGroup("preload",c),e=Resource.el("#evt_spin"),d.addEvent("progress",function(a,b){e.innerHTML="loading: "+Math.floor(100*(a/b))+"%"}),d.addEvent("complete",b)})})},setScrollHeight:function(){var a=this.stageH-document.documentElement.clientHeight;this.scrollNode.style.height=4*this.stageH-a+"px"},setScrollView:function(){var a=Resource.getRes("page_bg_png");this.scrollNode.style.background="url("+a+")",this.setViewPort(3*-this.stageH),this.setScrollHeight()},setSceneAnimate:function(a){this.setViewPort(a)},setViewPort:function(a){var b=this.sceneContainer.get(0);d?(b.style["-webkit-transform"]="translate3d(0,"+a+"px,0)",b.style["transform"]="translate3d(0,"+a+"px,0)"):b.style.top=a+"px"},showBigMan:function(){this.isBigManShow||(d?this.bigMan.css({"-webkit-transform":"translate3d(0,"+-this.bigManH+"px,0)",transform:"translate3d(0,"+-this.bigManH+"px,0)"}):this.bigMan.stop().animate({marginTop:-this.bigManH},800,"easeOutCubic"),this.isBigManShow=!0)},hideBigMan:function(){this.isBigManShow&&(d?this.bigMan.css({"-webkit-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)"}):this.bigMan.stop().animate({marginTop:0},800,"easeOutCubic"),this.isBigManShow=!1)},initEvents:function(){var e,a=this,b=this.book.height()/12,c=function(){var c,e,b=a.sceneContainer;return d?(c=b.get(0).style["transform"]||b.get(0).style["-webkit-transform"],e=/translate3d\(([\s\S]+)\)/g.exec(c),parseFloat(e[1].split(",")[1])):parseFloat(b.css("top"))||0}();window.onscroll=e=function(){var e=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;a.setSceneAnimate(c+e),a.snowScene.setAnimates(e),a.scene1.setBookFrame(Math.ceil(e/b)),a.scene1.setScrollAnim(e),e>a.stageH&&(a.scene2.dispatchEvent("SCENE_ENTER_2"),a.scene2.setScroll(e)),e>2*a.stageH&&(a.scene3.dispatchEvent("SCENE_ENTER_3"),a.scene3.setScroll(e)),e>2.8*a.stageH?(a.scene4.dispatchEvent("SCENE_ENTER_4"),a.scene4.setScroll(e),a.snowContainer[0].style.display="none"):a.snowContainer[0].style.display="",e>.5*a.stageH&&e<2.3*a.stageH?a.showBigMan():a.hideBigMan()},window.onresize=function(){a.setScrollHeight()}}}),l=function(b){var e,f,g,h,i,j,k,l,m,n,o,p,c=navigator.appVersion.split("MSIE"),d=parseFloat(c[1]);if(d&&d>=5.5&&9>d&&document.body.filters)for(e=0,f=b.getElementsByTagName("img"),g=0;g<f.length;g++)h=f[g],i=h.src.toUpperCase(),h.getAttribute("usefixed")&&("PNG"!=i.substring(i.length-3,i.length)||h.getAttribute("usemap")||(e++,j=h.id||"ra_png_"+e.toString(),k=new Image,k.proData=j,k.onload=function(){a("#"+this.proData).css("width",this.width+"px").css("height",this.height+"px")},k.src=h.src,l="id='"+j+"' ",m=h.className?"class='"+h.className+"' ":"",n=h.title?"title='"+h.title+"' ":"title='"+h.alt+"' ",o="display:inline-block;"+h.style.cssText,"left"==h.align&&(o="float:left;"+o),"right"==h.align&&(o="float:right;"+o),h.parentElement.href&&(o="cursor:hand;"+o),p="<span "+l+m+n+' style="'+"width:"+h.width+"px; height:"+h.height+"px;"+o+";"+"filter:progid:DXImageTransform.Microsoft.AlphaImageLoader"+"(src='"+h.src+"', sizingMethod='scale');\"></span>",h.outerHTML=p,g-=1))},m=function(){var a=document.createElement("canvas").getContext;return a?!0:!1}(),m&&(location.href="childrenDay.html"),a(function(){new k})}(jQuery);