<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>make活动</title>
    <link rel="stylesheet" type="text/css" href="https://act.mcake.com/fangli/2018/pc/common/comm_header.css?v=1458723714">
    <!-- build:css css/main.css -->
    <link type="text/css" rel="stylesheet" href="css/animate.css" />
    <link type="text/css" rel="stylesheet" href="css/base.css" />
    <link type="text/css" rel="stylesheet" href="css/main.css" />
    <!-- endbuild -->
    <script type="text/javascript" src="js/jquery-1.js"></script>
</head>
<body>


<div style="height: 500px;"></div>


<div id="gua1" style="width:295px;margin:0 auto;">
    <div class="ka" style="position:static;">
        <canvas />
    </div>

</div>


<script>

  (function(bodyStyle) {

    bodyStyle.mozUserSelect = 'none';

    bodyStyle.webkitUserSelect = 'none';



    var img = new Image();

    var canvas = document.querySelector('canvas');

    canvas.style.backgroundColor='transparent';

    canvas.style.position = 'absolute';



    img.addEventListener('load', function(e) {

      var ctx;

      var w = img.width,

        h = img.height;

      var offsetX = canvas.offsetLeft,

        offsetY = canvas.offsetTop;

      var mousedown = false;


    /**添加*/
      window.addEventListener('scroll', function() {


      });



      function layer(ctx) {

        ctx.fillStyle = 'gray';

        ctx.fillRect(0, 0, w, h);

      }



      function eventDown(e){

        e.preventDefault();

        mousedown=true;

      }



      function eventUp(e){

        e.preventDefault();

        mousedown=false;

      }



      function eventMove(e){

        e.preventDefault();



        if(mousedown) {

          if(e.changedTouches){

            e=e.changedTouches[e.changedTouches.length-1];

          }

          var rect = canvas.getBoundingClientRect();

          var x = (e.clientX + document.body.scrollLeft || e.pageX) - rect.left * (canvas.width / rect.width) || 0,

            y = (e.clientY + document.body.scrollTop || e.pageY) - rect.top * (canvas.height / rect.height) || 0;

          console.log(x,y);

          with(ctx) {

            beginPath()

            arc(x, y, 5, 0, Math.PI * 2);

            fill();  /*画*/

          }

        }

      }



      canvas.width=w;

      canvas.height=h;

      canvas.style.backgroundImage='url('+img.src+')';

      ctx=canvas.getContext('2d');

      ctx.fillStyle='transparent';

      ctx.fillRect(0, 0, w, h);

      layer(ctx);



      ctx.globalCompositeOperation = 'destination-out';



      canvas.addEventListener('touchstart', eventDown);

      canvas.addEventListener('touchend', eventUp);

      canvas.addEventListener('touchmove', eventMove);

      canvas.addEventListener('mousedown', eventDown);

      canvas.addEventListener('mouseup', eventUp);

      canvas.addEventListener('mousemove', eventMove);

    });

    img.src = 'img/prize.jpg';

  })(document.body.style);





</script>
</body>
</html>