<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>make活动</title>
    <!-- build:css css/vote.css -->
    <link type="text/css" rel="stylesheet" href="css/base.css" />
    <link type="text/css" rel="stylesheet" href="css/vote.css" />
    <!-- endbuild -->
</head>
<body>

<div id="evt_loading">
    <span id="evt_spin">loading: 0%</span>
</div>

<div id="evt_container" class="evt-container">

    <div class="sec-main">
      <!--  <div class="bt"><img src="images/vote-bt.png" alt=""></div>-->
        <div class="voteList">
            <ul>
                <div class="vote-bt"><img src="images/vote-bt.png" alt=""></div>
                <li><i>0</i></li>
                <li><i>50</i></li>
                <li><i>100</i></li>
                <li><i>150</i></li>
                <li><i>200</i></li>
                <li><i>250</i></li>
                <li><i>300</i></li>
                <li><i>350</i></li>
                <li><i>400</i></li>
                <li><i>450</i></li>
                <li><i>500</i></li>
                <li><i>550</i></li>
                <li class="li-last"><i>600</i></li>
                <dl class="vote-items">
                    <dd id="v001">
                        <div class="department"><b>生产部:</b>我们不一样 start</div>
                        <span class="title">票数：<b class="voteNum">30</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd id="v002">
                        <div class="department"><b>信息部:</b>无情的雨无情的你</div>
                        <span class="title">票数：<b class="voteNum">180</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd id="v003">
                        <div class="department"><b>生产部:</b>大王叫我来巡山,我到人间转一转</div>
                        <span class="title">票数：<b class="voteNum">20</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd id="v004">
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">90</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">70</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">150</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">80</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">130</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">100</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">200</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">200</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">300</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>
                    <dd>
                        <div class="department"><b>电商部:</b>1不让我的眼泪陪我过夜 </div>
                        <span class="title">票数：<b class="voteNum">100</b></span>
                        <div class="percent"></div>
                        <button class="vote-btn">投票</button>
                    </dd>

                </dl>
            </ul>
        </div>
    </div>
    <!--<div class="vote-wx voteMove">-->
        <!--<em><b>Distlemoto投票给</b> <span>生产部－歌曲－我们不一样,我们不一样,我们不一样</span>   <span>电商部－歌曲－月亮之上</span></em>-->
    <!--</div>-->
</div>
<script type="text/javascript" src="http://www.mcake.com/shop/theme/xth1/js/index/jquery.min.js?v=1411888163"></script>
<script src="http://edm.mcake.com/shuxy/2016/MovieClip/main.js"></script>
<!-- build:js js/vote.js -->
<script type="text/javascript" src="js/animate-util.js"></script>
<script type="text/javascript" src="js/resData.js"></script>
<script type="text/javascript" src="js/vote.js"></script>
<!-- endbuild -->
<script>

function voteInit() {
  var num = $(".vote-items dd").length;
  var vHeight = $('.voteList').height();
  var lineHeight = vHeight / (num+num-1)+"px";
  $(".vote-items dd").css({height:lineHeight,marginBottom:lineHeight,lineHeight:lineHeight});
  $(".title").css({lineHeight:lineHeight});

  var vote = {
    totalNum:600,
    voteNum:0,
    percent: 0,
    voteAni:function (ele) {
      var self = ele;
      this.voteNum = self.siblings('.title').find(".voteNum").text()-0;

      this.voteNum++;
      this.percent = this.voteNum / this.totalNum;

      if(this.percent >=1){
        this.percent=1;
      }

      self.siblings('.title').find(".voteNum").text(this.voteNum);
      self.siblings(".percent").stop().animate({
        width:(this.percent*100)+"%"
      },500);

    },

    vote:function (ele) {
      this.voteNum = ele.find('.title').find(".voteNum").text()-0;
      this.voteNum++;
      this.percent = this.voteNum / this.totalNum;

      if(this.percent >=1){
        this.percent=1;
      }
      console.log(this.voteNum,this.percent);
      ele.find('.title').find(".voteNum").text(this.voteNum);
      ele.find(".percent").stop().animate({
        width:(this.percent*100)+"%"
      },500);

    },

    init:function () {
      var self = this;

      $("#v002").click(function () {
         self.vote($(this));
      });


      $(".vote-items dd").each(function () {

        self.voteNum = $(this).find(".voteNum").text()-0;
        self.percent = self.voteNum / self.totalNum;
        /*刷新初始化*/
        $(this).find(".voteNum").text(self.voteNum);
        $(this).find('.percent').stop().animate({
          width:(self.percent*100)+"%"
        },500);


      });
    }
  }



  vote.init();

  var curline = 0;
  var winH = $(window).height();
  var wxH = 40;
  var msgline = Math.floor(winH /(wxH*1.5));
  console.log(wxH);




  setInterval(function () {
    var voteStr = '<div class="vote-wx voteMove">'
      +'<em><b>shimily投票给</b> <span>生产部－歌曲－【<i>我们不一样我们不一样我们不一样我们不一样我们不一样我们不一样</i>】</span>   <span>电商部－歌曲－【<i>月亮之上</i>】</span></em>'
      +'</div>';


    if(curline >= msgline-2){
      curline=0;
    }

    curline++;
    var wxtop = wxH*curline*1.6 +"px";
    console.log(wxtop);
    $(".evt-container").append(voteStr);
    $(".evt-container .vote-wx:last").stop().animate({top:wxtop},500);
   // $(".evt-container .vote-wx:first").remove();
  },500);




}
</script>
</body>
</html>